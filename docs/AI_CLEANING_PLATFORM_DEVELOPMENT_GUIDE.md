# DataSentry 数据清洗中台改造开发计划（基于已有功能）

> 说明：本计划不是从 0 开发，而是对已有功能做“保留 + 改造 + 增强”的排期。  
> 目标：明确每一阶段改哪些已有模块、何时完成、优先级是什么。

---

## 1. 已有功能改造清单（先看这个）

## 1.1 保留不动（继续复用）
- 在线清洗主链路与 pipeline。
- 批处理调度、租约、checkpoint、DLQ 主机制。
- 回滚任务调度与基本恢复执行。
- 人审任务与审批执行主流程。
- 成本台账、预算状态、指标与告警基础能力。

## 1.2 必须改造（本轮核心）

### 改造项 A：影子模式
- 当前状态：采样观测为主。
- 改造目标：升级为“主轨 vs 影子轨”双轨实验与结果对照。
- 优先级：**P0**。

### 改造项 B：策略治理
- 当前状态：策略可编辑，但发布治理弱。
- 改造目标：形成发布、回退、运行快照一致性治理。
- 优先级：**P0**。

### 改造项 C：回滚验证与冲突处置
- 当前状态：有回滚执行，但验证与冲突分级不足。
- 改造目标：恢复验证标准化 + 冲突分级处置。
- 优先级：**P0**。

### 改造项 D：审核运营化
- 当前状态：有审批流，但缺少队列/SLA治理。
- 改造目标：增加审核运营视角与反馈沉淀机制。
- 优先级：**P1**。

### 改造项 E：功能边界扩展
- 当前状态：批处理仅支持单主键、METADB备份硬约束。
- 改造目标：引入分阶段扩展能力（先架构预留，再逐步开放）。
- 优先级：**P1/P2**。

---

## 2. 总周期与阶段

总周期建议：**18 周**（因为本轮包含已有功能重构与兼容验证）。

- 阶段 1（第 1-4 周）：P0 改造基线搭建
- 阶段 2（第 5-8 周）：P0 主链路改造落地
- 阶段 3（第 9-12 周）：P1 运营化增强
- 阶段 4（第 13-16 周）：P1/P2 边界扩展与优化
- 缓冲验收（第 17-18 周）：回归与上线演练

---

## 3. 分阶段开发计划（顺序 + 优先级 + 完成时间）

## 阶段 1（第 1-4 周）：改造基线

### 任务 1：策略治理框架落地
- 优先级：**P0**
- 完成时间：第 1-2 周
- 改造对象：策略管理与运行快照相关模块。
- 完成标准：
  - 策略变更进入受控流程。
  - 运行任务仅使用冻结快照。

### 任务 2：影子实验框架落地
- 优先级：**P0**
- 完成时间：第 2-3 周
- 改造对象：影子能力与审计对照记录。
- 完成标准：
  - 支持主轨/影子轨并行判定。
  - 输出可比较的差异结果。

### 任务 3：回滚验证框架落地
- 优先级：**P0**
- 完成时间：第 3-4 周
- 改造对象：回滚执行后校验与结果分层。
- 完成标准：
  - 回滚结果可分层判定（全成/部分/冲突）。

---

## 阶段 2（第 5-8 周）：主链路改造

### 任务 4：影子模式双轨化接入在线与批处理
- 优先级：**P0**
- 完成时间：第 5-6 周
- 改造对象：在线清洗执行、批处理执行路径。
- 完成标准：
  - 两条通道均可做双轨评估。
  - 不影响主轨生产动作。

### 任务 5：回滚冲突分级处置
- 优先级：**P0**
- 完成时间：第 6-7 周
- 改造对象：回滚失败处置逻辑。
- 完成标准：
  - 冲突能区分类型并有处置策略（重试/转审/人工）。

### 任务 6：策略回退与运行一致性保障
- 优先级：**P0**
- 完成时间：第 7-8 周
- 改造对象：策略发布与作业运行协同机制。
- 完成标准：
  - 新策略可回退。
  - 回退不影响已运行实例一致性。

---

## 阶段 3（第 9-12 周）：运营化增强

### 任务 7：审核运营模型
- 优先级：**P1**
- 完成时间：第 9-10 周
- 改造对象：审核工作台与审核状态聚合。
- 完成标准：
  - 可查看积压、超时、处理效率。
  - 可按风险优先级治理队列。

### 任务 8：审核反馈沉淀机制
- 优先级：**P1**
- 完成时间：第 10-11 周
- 改造对象：审核结果归档与复盘输入。
- 完成标准：
  - 审核结果可进入规则复盘数据集。

### 任务 9：证据归档统一化
- 优先级：**P1**
- 完成时间：第 11-12 周
- 改造对象：清洗/回滚/审核记录归档。
- 完成标准：
  - 三条链路可统一追溯。

---

## 阶段 4（第 13-16 周）：边界扩展与优化

### 任务 10：批处理主键与备份模式扩展预留
- 优先级：**P1**
- 完成时间：第 13-14 周
- 改造对象：preflight 与执行抽象层。
- 完成标准：
  - 现有单主键逻辑保持兼容。
  - 为复合主键/备份模式扩展提供架构插槽。

### 任务 11：质量-成本联合看板优化
- 优先级：**P2**
- 完成时间：第 14-15 周
- 改造对象：运营指标聚合与看板呈现。
- 完成标准：
  - 影子差异、审核负载、回滚成功率、成本可统一观测。

### 任务 12：策略优化建议（半自动）
- 优先级：**P2**
- 完成时间：第 15-16 周
- 改造对象：复盘输出与策略建议引擎。
- 完成标准：
  - 能输出高争议规则与调优建议。

---

## 4. 缓冲验收阶段（第 17-18 周）

### 任务 13：全链路回归
- 优先级：**P0**
- 完成时间：第 17 周
- 完成标准：
  - 在线、批处理、回滚、审核全链路稳定。

### 任务 14：灰度与上线演练
- 优先级：**P0**
- 完成时间：第 18 周
- 完成标准：
  - 关键改造项通过灰度验证。
  - 上线回退预案可执行。

---

## 5. 优先级总览

### P0（先做）
1. 策略治理框架。
2. 影子双轨框架与接入。
3. 回滚验证与冲突分级。
4. 策略回退与运行一致性。
5. 最终回归与上线演练。

### P1（第二顺位）
1. 审核运营模型。
2. 审核反馈沉淀。
3. 证据统一归档。
4. 主键/备份模式扩展预留。

### P2（增益优化）
1. 质量-成本联合看板。
2. 策略优化建议能力。

---

## 6. 每月交付目标

### 第 1 个月
- 交付重点：治理基线（策略、影子、回滚验证）搭好。

### 第 2 个月
- 交付重点：P0 改造项进入主链路并稳定运行。

### 第 3 个月
- 交付重点：审核与证据进入运营化阶段。

### 第 4 个月
- 交付重点：边界扩展与策略优化能力补齐。

### 第 5 个月（前半）
- 交付重点：回归、灰度、上线与回退演练。

---

## 7. 改造风险与应对

1. **风险：旧逻辑与新治理并存导致复杂度上升**  
   应对：采用“兼容模式 + 功能开关 + 分阶段切流”。

2. **风险：回滚改造影响生产恢复效率**  
   应对：先引入验证层，再逐步引入冲突分级，不一次性重构。

3. **风险：审核流程增强后队列短期积压**  
   应对：先做优先级与批处理策略，确保吞吐不下降。

4. **风险：影子双轨导致计算成本上升**  
   应对：采样比例可控，优先在高风险场景启用。

---

## 8. 完成定义（DoD）

一项改造任务“完成”必须同时满足：

1. 主链路兼容未破坏。  
2. 指标/日志可观测。  
3. 失败路径可恢复。  
4. 回归测试通过。  
5. 可在灰度环境验证并可回退。

